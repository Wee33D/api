<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Conference</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    
    <script type="text/javascript" src="https://unpkg.com/webcam-easy@1.0.5/dist/webcam-easy.min.js"></script>
</head>
<body>
    <div class="header">
        <nav>
        <img src="img/logo.png" class="logo">
        <ul>
            <li > <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16" >
                <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                <path fill-rule="evenodd" d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z"/>
                <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
              </svg>
            </li>
              <li ><a href="homepage.html"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-camera-video-fill" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/>
              </svg></a>
            </li>
            <li><a href="videolist.html"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-file-play" viewBox="0 0 16 16">
              <path d="M6 10.117V5.883a.5.5 0 0 1 .757-.429l3.528 2.117a.5.5 0 0 1 0 .858l-3.528 2.117a.5.5 0 0 1-.757-.43z"/>
              <path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
            </svg></a>
          </li>
            <li class="active" ><a href="message.html"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-chat-left-text" viewBox="0 0 16 16">
                <path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                <path d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6zm0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5z"/>
              </svg></a>
            </li>
            <li><a href="settings.html"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-gear-wide-connected" viewBox="0 0 16 16">
                <path d="M7.068.727c.243-.97 1.62-.97 1.864 0l.071.286a.96.96 0 0 0 1.622.434l.205-.211c.695-.719 1.888-.03 1.613.931l-.08.284a.96.96 0 0 0 1.187 1.187l.283-.081c.96-.275 1.65.918.931 1.613l-.211.205a.96.96 0 0 0 .434 1.622l.286.071c.97.243.97 1.62 0 1.864l-.286.071a.96.96 0 0 0-.434 1.622l.211.205c.719.695.03 1.888-.931 1.613l-.284-.08a.96.96 0 0 0-1.187 1.187l.081.283c.275.96-.918 1.65-1.613.931l-.205-.211a.96.96 0 0 0-1.622.434l-.071.286c-.243.97-1.62.97-1.864 0l-.071-.286a.96.96 0 0 0-1.622-.434l-.205.211c-.695.719-1.888.03-1.613-.931l.08-.284a.96.96 0 0 0-1.186-1.187l-.284.081c-.96.275-1.65-.918-.931-1.613l.211-.205a.96.96 0 0 0-.434-1.622l-.286-.071c-.97-.243-.97-1.62 0-1.864l.286-.071a.96.96 0 0 0 .434-1.622l-.211-.205c-.719-.695-.03-1.888.931-1.613l.284.08a.96.96 0 0 0 1.187-1.186l-.081-.284c-.275-.96.918-1.65 1.613-.931l.205.211a.96.96 0 0 0 1.622-.434l.071-.286zM12.973 8.5H8.25l-2.834 3.779A4.998 4.998 0 0 0 12.973 8.5zm0-1a4.998 4.998 0 0 0-7.557-3.779l2.834 3.78h4.723zM5.048 3.967c-.03.021-.058.043-.087.065l.087-.065zm-.431.355A4.984 4.984 0 0 0 3.002 8c0 1.455.622 2.765 1.615 3.678L7.375 8 4.617 4.322zm.344 7.646.087.065-.087-.065z"/>
         
        </ul>
        </nav>

        <div class="container">
            <div class="top-icons">
                <h2>Message Json Page</h2>
                
             </div>
             <div class="row">
                <div class="col-1a">
                    <div class="chatbox">
                        <p>Chat Box</p> <br>
                        <div class="col-8 p-0" style="height: calc(100% - 110px);">
                            <div class="d-flex justify-content-between px-4 py-2 w-100 border-bottom border-primary border-4" style="height: 60px;">

                                <div>
                                    <input id="json-upload" class="btn btn-primary" type="file">
                                    <button class="btn btn-primary" onclick="downloadToJSON()">Save to JSON</button>
                                </div>
                            </div>

                            <div id="chatbox" class="p-2">
                                
                                    <div class="message-container">
                                        <img src="img/anonymous.jpg" alt="Avatar" style="width:100%;">
                                        <div class="my-message">Hi, My name is Mukhlis, I am a Software Engineering student at UTM. Nice to meet you!</div>
                                        <small>10 May, 15:15</small>
                                    </div>
                                
                                
                                <br>

                                
                                    <div class="message-container2">
                                        <img src="img/bill_gates.jpg" alt="Avatar" class="right" style="width:100%;">
                                        <div class="sender-message">Hi, My name is Bill Gates, I am the Windows Founder. Nice to meet you too!</div>
                                        <small>10 May, 15:16</small>
                                    </div>
                            
                            </div>

                            <div class="row mx-2 p-2 border-top border-info border-1" id="messagebox">
                                <textarea placeholder="Write your reply here.." style="height: 100%; resize: none;"></textarea>

                                <div class="col-1">
                                    <button class="btn btn-primary" onclick="sendMessage()">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        </div>
           

        </div>
    </div>

    <script>
      var months = [
                            "January",
                            "February",
                            "March",
                            "April",
                            "May",
                            "June",
                            "July",
                            "August",
                            "Septemeber",
                            "October",
                            "November",
                            "December"
                        ];

                        var chatData =

                            [
                                {
                                    "sender": "client",
                                    "message": "Hi, My name is Ady, I am a 3rd Year Software Engineering student at UTM. Nice to meet you",
                                    "time": "2022-05-23T15:15:00+08:00"
                                },

                                {
                                    "sender": "remote",
                                    "message": "Hi, My name is Sundar Pichai, I am the CEO of Google. Nice to meet you too!!",
                                    "time": "2022-05-23T15:16:30+08:00"
                                }
                            ];

                        $(document).ready(function () {
                            $("#json-upload").change(loadFromJSON);
                        });

                        async function loadFromJSON(event) {
                            const file = event.target.files;

                            await file[0].text().then(value => {
                                chatData = JSON.parse(value);

                            });

                            $("#chatbox").html("");
                            console.log(chatData);
                            chatData.forEach((value, index, arr) => {
                                console.log(value);
                                let prefix = '<div class="d-flex flex-row-reverse mb-4"><div class="message-container"><div class="my-message px-2 py-1 border border-dark rounded-1">';
                                let suffix = '</div>';

                                if (value.sender == "remote") {
                                    prefix = '<div class="d-flex mb-4"><div class="message-container"><div class="sender-message px-2 py-1 border border-dark rounded-1">';
                                }

                                let time = new Date(value.time);
                                let timeText = "<small>" + time.getDate() + " " + months[time.getMonth()] + ", " + time.getHours() + ":" + time.getMinutes() + "<small>";
                                $("#chatbox").append(prefix + value.message + suffix + timeText + "</div></div>");
                            });
                        }

                        function sendMessage() {
                            let prefix = '<div class="d-flex flex-row-reverse mb-4"><div class="message-container"><div class="my-message px-2 py-1 border border-dark rounded-1">';
                            let suffix = '</div>';
                            let time = new Date();
                            let ISOTime = time.getUTCFullYear() + "-" + appendZero(time.getUTCMonth()) + "-" + appendZero(time.getUTCDate()) + "T" + appendZero(time.getUTCHours()) + ":" + appendZero(time.getUTCMinutes()) + ":" + appendZero(time.getUTCSeconds()) + "Z";
                            let timeText = "<small>" + time.getDate() + " " + months[time.getMonth()] + ", " + time.getHours() + ":" + time.getMinutes() + "<small>";
                            let messageValue = $("textarea").val()

                            $("#chatbox").append(prefix + messageValue + suffix + timeText + "</div></div>");
                            $("textarea").val("");
                            chatData.push({ "sender": "client", "message": messageValue, "time": ISOTime });


                            let prefix2 = '<div class="message-container2"><div class="message-container2 img"><div class="sender-message ">';
                            let suffix2 = '</div>';
                            time = new Date();
                            ISOTime = time.getUTCFullYear() + "-" + appendZero(time.getUTCMonth()) + "-" + appendZero(time.getUTCDate()) + "T" + appendZero(time.getUTCHours()) + ":" + appendZero(time.getUTCMinutes()) + ":" + appendZero(time.getUTCSeconds()) + "Z";
                            timeText = "<small>" + time.getDate() + " " + months[time.getMonth()] + ", " + time.getHours() + ":" + time.getMinutes() + "<small>";
                            $("#chatbox").append(prefix2 + "This is an automatic reply" + suffix2 + timeText + "</div></div>");
                            chatData.push({ "sender": "remote", "message": "This is an automatic reply", "time": ISOTime });

                            console.log(chatData);
                        }

                        function downloadToJSON() {
                            const a = document.createElement("a");
                            const data = new Blob([JSON.stringify(chatData)], { type: "text/plain" });

                            a.href = URL.createObjectURL(data);
                            a.download = "chat.json";
                            a.click();
                        }

                        function appendZero(value) {
                            if (String(value).length == 1) {
                                return "0" + value;
                            }

                            return value;
                        }  
      
    </script>
</body>
</html> 